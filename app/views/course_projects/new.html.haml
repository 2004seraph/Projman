
- project_data = {}
- errors = {}
- if session[:new_project_data].present?
  - project_data = session[:new_project_data]
  - errors = project_data[:errors]

= form_tag "/projects/new", method: :post, id:"create-project-form" do
  %div
    .d-flex.justify-content-end
      %button.btn.btn-primary.mb-2.me-2#create-project-save-button{type: "submit"}
        Save
      %button.btn.btn-secondary.mb-2{type: "button"}
        Discard

    -# MAIN CONTENT
    .mb-3
      .input-group
        %h2.input-group-text.fs-4.fw-bold.mb-0 Module
        %select.form-select.form-select-sm.fs-5{id: "module-selection", name:"module_selection", aria: {label: "Default select example"}, style: "width:auto; max-width:100%"}
          - project_data[:modules_hash].each do |code, name|
            %option{value: code, selected: (code == project_data[:modules_hash].keys.first)}
              = "#{code} #{name}"

      .input-group
        %h2.input-group-text.fs-4.fw-bold.mb-0 Project Name
        %input.form-control.fs-5.fw-semibold{type: "text", id:"project-name", name: "project_name", placeholder:"Name"}

      - if errors[:project_name_empty].present?
        .container-fluid.fs-6.text-danger
          = errors[:project_name_empty]

    -# PROJECT CHOICES
    .card#project-choices.mb-3
      .card-header.d-flex.align-items-center
        %input.form-check-input.p-2.me-2.mt-0#project-choices-enable{type: "checkbox", value: "",
        checked: "checked", name: "project_choices_enable", data: { url: new_project_toggle_project_choices_projects_path }}
        %h2.fs-4.m-0 Project Choices

      .card-body.pb-3
        %ul.list-group.list-group-flush.mb-2#project-choices-list  
          - project_data[:project_choices].each do |name|
            = render partial: 'components/group-item-simple', locals: { item_text: name, deletion_action_url:new_project_remove_project_choice_projects_path }

        %button.btn.btn-primary.mb-2{type: "button", "data-bs-toggle": "modal",
          "data-bs-target": "#add-project-choice-modal"}
          %i.bi.bi-plus
          Add
        
        .row.align-items-center
          .col
            %label.col-form-label.fs-6.me-3{for: "project-allocation-method"} Project Allocation
          .col-8
            %select.form-select.form-select-sm{id: "project-allocation-method", name: "project_allocation_method", aria: {label: "Default select example"}, style: "width:auto; max-width:100%"}
              - project_data[:project_allocation_modes_hash].each do |value, string|
                %option{value: value, selected: (value == project_data[:project_allocation_modes_hash].keys.first)}
                  = "#{string}"
      
      -# TEAM CONFIGURATION
    .card#team-configuration.mb-3
      .card-header
        %h2.fs-4.m-0 Team Configuration

      .card-body.pb-3
        .row.align-items-center
          .col
            %label.col-form-label.fs-6.me-3{for: "team-size"} Team Size  
          .col-8  
            .input-group.mb-2{style: "width:fit-content"}
              %input.form-control.form-control-sm{ type: "number", id: "team-size", name:"team_size", min: "0", value: "4"}

        .row.align-items-center
          .col
            %label.col-form-label.fs-6.me-3{for: "team-allocation-method"} Team Allocation Mode
          .col-8
            %select.form-select.form-select-sm{id: "team-allocation-method", name: "team_allocation_method", aria: {label: "Default select example"}, style: "width:auto; max-width:100%"}
              - project_data[:team_allocation_modes_hash].each do |value, string|
                %option{value: value, selected: (value == project_data[:team_allocation_modes_hash].keys.first)}
                  = "#{string}"
                  

    -# TEAM PREFERENCE FORM SETTINGS
    .card#team-preference-form-settings.mb-3
      .card-header
        %h2.fs-4.m-0 Team Preference Form Settings

      .card-body.pb-3
        .row.align-items-center
          .col
            %label.col-form-label.fs-6.me-3{for: "preferred-teammates"} Preferred Teammates
          .col-8
            .input-group{style: "width:fit-content"}
              %input.form-control.form-control-sm{ type: "number", name: "preferred_teammates", id: "preferred-teammates", min: "0", value: "2"}

        .row.align-items-center
          .col
            %label.col-form-label.fs-6{for: "avoided-teammates"} Avoided Teammates
          .col-8
            .input-group{style: "width:fit-content"}
              %input.form-control.form-control-sm{ type: "number", id: "avoided-teammates", name:"avoided_teammates", min: "0",  value: "2"}

    -# DEADLINES AND MILESTONES
    .card#timings.mb-3
      .card-header
        %h2.fs-4.m-0 Timings

      .card-body.pb-3
        %h3.fs-5.mb-2 Deadlines
        .mb-3
          .row.align-items-center#project-deadline-row
            .col
              %label.col-form-label.fs-6.me-3{for: "project-deadline"} Project Deadline
            .col-8
              .input-group{style: "width:fit-content"}
                = render partial: 'components/datepicker_input', locals: { id: 'project-deadline', name:"project_deadline", placeholder_text: 'Select Date' }

          .row.align-items-center#teammate-preference-form-deadline-row
            .col
              %label.col-form-label.fs-6.me-3{for: "teammate-preference-form-deadline"} Teammate Preference Form
            .col-8
              .input-group{style: "width:fit-content"}
                = render partial: 'components/datepicker_input', locals: { id: 'teammate-preference-form-deadline',name:"teammate_preference_form_deadline", placeholder_text: 'Select Date' }

          .row.align-items-center#project-preference-form-deadline-row
            .col
              %label.col-form-label.fs-6.me-3{for: "project-preference-form-deadline"} Project Preference Form
            .col-8
              .input-group{style: "width:fit-content"}
                = render partial: 'components/datepicker_input', locals: { id: 'project-preference-form-deadline',name:"project_preference_form_deadline", placeholder_text: 'Select Date' }

        %h3.fs-5.mb-2 Milestones
        %ul.list-group.list-group-flush.mb-2.overflow-hidden#project-milestones-list

        %button.btn.btn-primary.mb-2{type: "button", "data-bs-toggle": "modal",
          "data-bs-target": "#add-project-milestone-modal"}
          %i.bi.bi-plus
          Add

    -# PROJECT FACILITATORS
    .card#project-facilitators.mb-3
      .card-header.d-flex.align-items-center
        %h2.fs-4.m-0 Project Facilitators

      .card-body.pb-3
        %ul.list-group.list-group-flush.mb-2#project-facilitators-list

        %button.btn.btn-primary.mb-2{type: "button", id: "open-add-facilitators-modal", "data-bs-toggle": "modal",
          "data-bs-target": "#add-project-facilitators-modal"}
          %i.bi.bi-plus
          Add

    .card#mark-scheme.mb-3
      .card-header.d-flex.align-items-center
        %h2.fs-4.m-0 Mark Scheme

      .card-body.pb-3.d-flex.justify-content-center.align-items-center
        %label.btn.btn-primary.btn-lg{for: "mark-scheme"}
          %i.bi.bi-upload
          Upload
          %input{type: "file", id: "mark-scheme", accept: ".csv", style: "display: none;"}
    


-# MODALS

-# ADD PROJECT CHOICE MODAL
= render 'components/modal-single-text-entry', 
  modal_id: 'add-project-choice-modal',
  title: 'New Project Choice',
  prompt: 'Input project choice name',
  submission_url: new_project_add_project_choice_projects_path,
  form_input_id: 'new-project-choice-name', 
  form_input_name: 'project_choice_name', 
  confirm_text: 'Confirm', 
  confirm_onclick_function: ""

-# ADD MILESTONE MODAL
= render 'components/modal-single-text-entry', 
  modal_id: 'add-project-milestone-modal', 
  title: 'New Project Milestone', 
  prompt: 'Input milestone name', 
  submission_url: new_project_add_project_milestone_projects_path,
  form_input_id: 'new-project-milestone-name', 
  form_input_name: 'project_milestone_name', 
  confirm_text: 'Confirm', 
  confirm_onclick_function: ""

-# ADD FACILITATORS MODAL
= render 'components/modal-search-multiple', 
  modal_id: 'add-project-facilitators-modal', 
  title: 'Add Project Facilitators', 
  prompt: 'Input facilitators name', 
  form_input_id: 'new-project-facilitator-name', 
  form_input_name: 'project_facilitator_name', 
  current_selection_text: 'current selection',
  list_group_id: 'facilitator-selection-group',
  confirm_text: 'Confirm', 
  confirm_onclick_function: "",
  add_to_selection_url: new_project_add_to_facilitator_selection_projects_path,
  submission_url: new_project_add_facilitator_selection_projects_path,
  on_open_action_url: new_project_clear_facilitator_selection_projects_path
